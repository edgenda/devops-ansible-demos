---
- name: Disable SELinux
  become: true
  hosts: all
  tasks:
    - name: disable selinux
      selinux:
        state: disabled
      notify: reboot
  handlers:
    - name: reboot
      shell: "sleep 5 && shutdown -r now"
      listen: reboot
      async: 1
      poll: 0
    - name: wait reboot
      wait_for_connection:
        delay: 10
        connect_timeout: 5
        sleep: 5
        timeout: 300
      listen: reboot
- name: Install Jenkins
  become: true
  hosts: host02
  tasks:
    - name: install openjdk8
      yum:
        name: java-1.8.0-openjdk
        state: present
    - name: install Jenkins Repo
      get_url:
        url: http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo
        dest: /etc/yum.repos.d/jenkins.repo
    - name: install jenkins repository key
      rpm_key:
        key: https://jenkins-ci.org/redhat/jenkins-ci.org.key
        state: present
    - name: install jenkins
      yum:
        name: jenkins
        state: present
    - name: start and enable jenkins service
      service:
        name: jenkins
        state: started
        enabled: true
    - name: ensure jenkins is started
      shell: cat /var/lib/jenkins/secrets/initialAdminPassword
      register: initialAdminPassword
      retries: 5
      delay: 10
      until: initialAdminPassword is succeeded
    - name: output initial admin password
      debug:
        var: initialAdminPassword.stdout
      when: initialAdminPassword is succeeded


























































